<!DOCTYPE html>
<html lang="ky">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>CAPI ‚Äî 100% —Ç–∞–±–∏–≥—ã–π –ø—Ä–æ–¥—É–∫—Ü–∏—è</title>
  <meta name="theme-color" content="#d86916"/>
  <style>
    :root{--mango:#f3a21b;--honey:#d86916;--ink:#1e293b;--muted:#64748b;--card:#fff;--bg:#fff7ec}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Helvetica,Arial;color:var(--ink);background:linear-gradient(180deg,#fff,var(--bg))}
    .topbar{position:sticky;top:0;z-index:5;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 16px;background:rgba(255,255,255,.88);backdrop-filter:saturate(1.2) blur(6px);border-bottom:1px solid #ffe1ad}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:42px;height:42px;border-radius:12px;background:radial-gradient(100% 100% at 30% 30%, var(--mango), var(--honey));box-shadow:0 6px 20px rgba(216,105,22,.25)}
    .brand-name{font-weight:800} .slogan{font-size:12px;color:var(--muted)}
    .controls{display:flex;align-items:center;gap:8px}
    select,.btn{border:1px solid #ffd489;background:#fff;color:var(--ink);padding:8px 10px;border-radius:12px;font:inherit}
    .btn.mango{background:linear-gradient(180deg,#fff8eb,#ffe3b3);font-weight:700;cursor:pointer}
    .shell{max-width:1100px;margin:0 auto;padding:16px}
    .notice{margin:10px 16px;padding:10px 12px;border:1px dashed #ffd08a;border-radius:12px;background:#fff7e8;color:#6a3c13;font-weight:600}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
    .card{background:var(--card);border:1px solid #ffe1ad;border-radius:18px;padding:14px;box-shadow:0 6px 16px rgba(243,162,27,.08);display:flex;flex-direction:column;gap:10px}
    .card img{width:100%;height:160px;object-fit:cover;border-radius:12px;border:1px solid #ffe1ad}
    .qty{display:flex;align-items:center;gap:8px}.qty .q{min-width:22px;text-align:center;display:inline-block}

    /* ===== AJUSTE CARRITO PARA CELULARES (bottom sheet) ===== */
    .popup{
      position:fixed; inset:0; z-index:1000;
      display:block; pointer-events:none;
    }
    .popup.open{ pointer-events:auto; }
    .backdrop{
      position:absolute; inset:0; background:rgba(0,0,0,.35);
      opacity:0; transition:opacity .2s ease;
    }
    .popup.open .backdrop{ opacity:1; }
    .panel{
      position:fixed; left:0; right:0; bottom:0;
      top: calc(env(safe-area-inset-top, 0px) + 64px); /* ‚âà alto header */
      background:#fff; border-top-left-radius:18px; border-top-right-radius:18px;
      border-left:0; box-shadow:0 -10px 30px rgba(0,0,0,.15);
      width:auto; max-height: calc(100dvh - env(safe-area-inset-top) - 64px);
      transform: translateY(100%);
      transition: transform .25s ease;
      display:flex; flex-direction:column;
      padding:
        calc(12px + env(safe-area-inset-top, 0px))
        16px
        calc(14px + env(safe-area-inset-bottom, 0px));
      overflow:hidden;
    }
    .popup.open .panel{ transform: translateY(0); }
    .panel #cartItems{ flex:1; overflow:auto; -webkit-overflow-scrolling:touch; }
    body.no-scroll{ overflow:hidden; height:100dvh; }
    /* ===== FIN AJUSTE CARRITO ===== */

    .badge{background:#dc2626;color:#fff;border-radius:999px;min-width:18px;padding:2px 6px;font-size:12px}
    .foot{color:var(--muted);text-align:center;padding:16px}

    /* Bot√≥n eliminar especial */
    .btn-remove {
      background: linear-gradient(180deg, rgba(255, 0, 0, 0.12), rgba(255, 0, 0, 0.18));
      border: 1px solid rgba(255, 0, 0, 0.25);
      color: #000000 !important;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.05s ease, background 0.2s ease;
      border-radius: 12px;
      padding: 8px 10px;
    }
    .btn-remove:hover {
      background: linear-gradient(180deg, rgba(255, 0, 0, 0.18), rgba(255, 0, 0, 0.25));
    }
    .btn-remove:active {
      transform: scale(0.97);
    }
  </style>

  <!-- OVERRIDE im√°genes -->
  <style id="imgfix-override">
    #product-list .product img,
    .product img,
    img.product-image {
      height: 320px !important;
      width: 100% !important;
      object-fit: contain !important;
      display: block !important;
      margin: 0 auto 10px !important;
      border-radius: 12px !important;
      border: 1px solid #ffe1ad !important;
    }
  </style>
</head>
<body>
  <!-- resto de tu HTML igual -->
  <!-- ... -->

<script>
/* igual que antes, pero cambiamos la clase en updateCart() */

function updateCart(){
  const items = document.getElementById("cartItems");
  const count = document.getElementById("cartCount");
  items.innerHTML = "";
  let totUSD=0, totKGS=0;

  cart.forEach((it,idx)=>{
    const row = document.createElement("div");
    row.className = "row";

    const icon = it.id === "honey" ? "üçØ" : it.id === "mango" ? "üå∂Ô∏è" : "‚Ä¢";
    row.innerHTML = `<span>${icon} ${it.name} ${it.size} ml x${it.qty} (${it.price.kgs} —Å–æ–º / $${money(it.price.usd)})</span>`;

    const rm = document.createElement("button");
    rm.className = "btn-remove";
    rm.textContent = "üóë " + T.remove[lang];
    rm.onclick = ()=>{ cart.splice(idx,1); updateCart(); };

    row.appendChild(rm);
    items.appendChild(row);

    totUSD += it.price.usd * it.qty;
    totKGS += it.price.kgs * it.qty;
  });

  document.getElementById("totals").textContent = `TOTAL: ${totKGS} —Å–æ–º / $${money(totUSD)}`;

  if(cart.length > 0){
    count.style.display = "inline-block";
    count.textContent = cart.reduce((a,c)=>a+c.qty,0);
  } else {
    count.style.display = "none";
  }
}
</script>
</body>
</html>
